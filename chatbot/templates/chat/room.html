<!DOCTYPE html>
<html>
<head>
    <title>TripSnap Ï±óÎ¥á ÌÖåÏä§Ìä∏</title>
    <style>
        body { font-family: Arial, sans-serif; max-width: 800px; margin: 50px auto; padding: 20px; }
        #chat-log { height: 400px; overflow-y: scroll; border: 1px solid #ccc; padding: 10px; margin-bottom: 10px; }
        .message { margin: 10px 0; padding: 10px; border-radius: 5px; }
        .user { background: #e3f2fd; text-align: right; }
        .bot { background: #f5f5f5; }
        input { width: 70%; padding: 10px; }
        button { padding: 10px 20px; }
    </style>
</head>
<body>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <h1>üçû TripSnap Ï±óÎ¥á</h1>
    <div id="chat-log"></div>
    <input id="message-input" type="text" placeholder="Î©îÏãúÏßÄÎ•º ÏûÖÎ†•ÌïòÏÑ∏Ïöî...">
    <button onclick="sendMessage()">Ï†ÑÏÜ°</button>

    <script>
        const chatLog = document.getElementById('chat-log')
        const messageInput = document.getElementById('message-input')

        // csrf Token: https://jangsus1.tistory.com/2
        axios.defaults.xsrfCookieName = 'csrftoken'
        axios.defaults.xsrfHeaderName = 'X-CSRFTOKEN'

        async function sendMessage() {
            const message = messageInput.value.trim()
            if (!message) return;

            addMessage('ÎÇò', message)
            messageInput.value = ''

            try {
                const response = await axios.post('/chatbot/chat/', {
                    message: message
                });

                const data = response.data

                if (data.llm_response) {
                    addMessage('Ï±óÎ¥á', data.llm_response)
                }

                if (data.results && data.results.length > 0) {
                    let recs = '<br><b>Ï∂îÏ≤ú ÎπµÏßë:</b><br>'
                    data.results.forEach((rec, i) => {
                        recs += `${i+1}. ${rec.place_name}<br>`
                    })
                    addMessage('Ï±óÎ¥á', recs)
                }
            } catch (error) {
                addMessage('Ïò§Î•ò', error.message)
            }
        }
        
        function addMessage(sender, text) {
            const msgDiv = document.createElement('div')
            msgDiv.className = 'message ' + (sender === 'ÎÇò' ? 'user' : 'bot')
            msgDiv.innerHTML = `<b>${sender}:</b> ${text}`
            chatLog.appendChild(msgDiv)
            chatLog.scrollTop = chatLog.scrollHeight
        }
        
        messageInput.addEventListener('keypress', function(e) {
            if (e.key === 'Enter') sendMessage();
        })
    </script>
</body>
</html>